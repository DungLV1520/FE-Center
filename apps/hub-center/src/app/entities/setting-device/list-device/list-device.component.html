<div class="user-list-wrapper">
  <div class="filter-header">
    <div class="search-box">
      <nz-input-group [nzSuffix]="suffixIconSearch" nzSize="large">
        <input
          type="text"
          nz-input
          placeholder="Tìm kiếm theo tên, series thiết bị"
        />
      </nz-input-group>
      <ng-template #suffixIconSearch>
        <span nz-icon nzType="search"></span>
      </ng-template>
    </div>
    <div class="btn-action-group">
      <button
        nz-button
        nzType="default"
        class="create-team"
        nzSize="large"
        (click)="onShowModeTable()"
      >
        <ng-container *ngIf="!isModeViewTable">
          <span nz-icon nzType="table" nzTheme="outline"></span>
          <span>Chế độ xem: bảng</span>
        </ng-container>
        <ng-container *ngIf="isModeViewTable">
          <span nz-icon nzType="appstore" nzTheme="outline"></span>
          <span>Chế độ xem: lưới</span>
        </ng-container>
      </button>
      <button
        (click)="reloadPage()"
        nz-button
        nzType="default"
        class="create-team"
        nzSize="large"
      >
        <span nz-icon nzType="reload" nzTheme="outline"></span>
        <span>Cập nhật danh sách</span>
      </button>
    </div>
  </div>
  <div class="device-info">
    <nz-tag>Tổng: {{ totalDevicesCount }}</nz-tag>
    <nz-tag [nzColor]="'green'"
      >Đang hoạt động: {{ totalDevicesOnlineCount }}</nz-tag
    >
    <nz-tag [nzColor]="'red'"
      >Mất kết nối: {{ totalDevicesOfflineCount }}</nz-tag
    >
  </div>
  <div class="content-wrapper">
    <div *ngIf="isModeViewTable" class="table-body" style="overflow: auto">
      <nz-table
        *ngIf="devices$ | async as devices"
        #filterTable
        [nzFrontPagination]="false"
        [nzShowPagination]="false"
        [nzData]="devices || []"
      >
        <thead>
          <tr>
            <th
              *ngFor="let column of listOfColumn"
              [ngStyle]="{
                width: column.priority === 0 ? '68px' : '100%',
                whiteSpace: 'nowrap'
              }"
            >
              {{ column.title }}
            </th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let data of devices; let i = index">
            <td nz>{{ i + 1 }}</td>
            <td>
              {{ data.name }}
            </td>
            <td>
              <nz-tag [nzColor]="data.status === 'ACTIVE' ? 'green' : 'red'">{{
                data.status === 'ACTIVE' ? 'Đang hoạt động' : 'Mất kết nối'
              }}</nz-tag>
            </td>
            <td>
              <nz-tag [nzColor]="data.available ? 'green' : 'red'">{{
                data.available ? 'Đang trình chiếu' : 'Không trình chiếu'
              }}</nz-tag>
            </td>
            <td>-</td>

            <td>-</td>
            <td>
              {{
                Date.now() - Number(data.timeOffAgo) | date : 'hh:mm dd/MM/yyyy'
              }}
            </td>
            <td>
              {{ data.location }}
            </td>
            <td>{{ data.model }}</td>

            <td>{{ data.serialNumber }}</td>
            <td>{{ data.manufacturer }}</td>
            <td>{{ data.appVersion }}</td>
            <td>{{ data.osVersion }}</td>
            <td style="cursor: pointer">
              <span
                nz-icon
                nzType="more"
                nzTheme="outline"
                nz-dropdown
                nzTrigger="click"
                [nzDropdownMenu]="moreAction"
              ></span>
              <nz-dropdown-menu #moreAction="nzDropdownMenu">
                <ul nz-menu>
                  <li nz-menu-item>Thiết lập lịch trình chiếu</li>
                  <li nz-menu-item>Kiểm tra kết nối</li>
                  <li nz-menu-item>Di chuyển</li>
                  <li nz-menu-item (click)="renameDevice(data.id, data.name)">
                    Đổi tên
                  </li>
                  <li
                    style="color: #a00705"
                    nz-menu-item
                    (click)="onConfirmDeleteDevice(data.id, data.name)"
                  >
                    Xoá thiết bị
                  </li>
                </ul>
              </nz-dropdown-menu>
            </td>

            <!--          <td>{{ data.insDatetime | date : 'dd/MM/yyyy hh:mm' }}</td>-->
            <!--          <td>{{ data.updDatetime | date : 'dd/MM/yyyy hh:mm' }}</td>-->
          </tr>
        </tbody>
      </nz-table>
    </div>
    <div *ngIf="!isModeViewTable" class="grid-body">
      <div
        *ngFor="let device of devices$ | async"
        class="grid-item"
        nz-popover
        nzPopoverTitle="{{ device.name }}"
        [nzPopoverContent]="contentTemplate"
        nzPopoverTrigger="hover"
        [nzPopoverMouseEnterDelay]="1.5"
      >
        <div class="device-name">{{ device.name }}</div>
        <div class="device-status">
          <span *ngIf="device.status === 'ACTIVE'" nz-icon>
            <svg
              width="16"
              height="16"
              viewBox="0 0 16 16"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <circle cx="8" cy="8" r="8" fill="#52C41A" />
            </svg>
          </span>
          <span *ngIf="device.status !== 'ACTIVE'" nz-icon>
            <svg
              width="16"
              height="16"
              viewBox="0 0 16 16"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <circle cx="8" cy="8" r="8" fill="#F5222D" />
            </svg>
          </span>
          <span class="time-desc"></span>
        </div>
        <div class="device-play-desc">
          <nz-tag [nzColor]="device.available ? '#5F7EEB' : '#D9D9D9'">{{
            device.available ? 'Đang trình chiếu' : 'Không trình chiếu'
          }}</nz-tag>
          <div class="icon-more-action" (click)="$event.stopPropagation()">
            <span
              nz-icon
              nzType="more"
              nzTheme="outline"
              nz-dropdown
              nzTrigger="click"
              [nzDropdownMenu]="moreAction"
            ></span>
            <nz-dropdown-menu #moreAction="nzDropdownMenu">
              <ul nz-menu>
                <li nz-menu-item>Thiết lập lịch trình chiếu</li>
                <li nz-menu-item>Kiểm tra kết nối</li>
                <li nz-menu-item>Di chuyển</li>
                <li nz-menu-item (click)="renameDevice(device.id, device.name)">
                  Đổi tên
                </li>
                <li
                  style="color: #a00705"
                  nz-menu-item
                  (click)="onConfirmDeleteDevice(device.id, device.name)"
                >
                  Xoá thiết bị
                </li>
              </ul>
            </nz-dropdown-menu>
          </div>
        </div>
        <ng-template #contentTemplate>
          <div>
            <div>Model máy: {{ device.model }}</div>
            <div>Số seri: {{ device.serialNumber }}</div>
            <div>Hãng sản xuất: {{ device.manufacturer }}</div>
            <div>Phiên bản app: {{ device.appVersion }}</div>
            <div>Phiên bản hệ điều hành: {{ device.osVersion }}</div>
            <div>Vị trí: {{ device.location }}</div>
          </div>
        </ng-template>
      </div>
    </div>
  </div>
  <div class="pagination-footer">
    <nz-pagination
      [nzPageIndex]="currentPage$ | async"
      [nzTotal]="totalDevicesCount"
      [nzPageSize]="pageSize"
      (nzPageIndexChange)="handlePageChange($event)"
    ></nz-pagination>
  </div>
</div>
<hub-loading></hub-loading>
